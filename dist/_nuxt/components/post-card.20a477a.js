(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{966:function(t,e,n){"use strict";n.r(e);var r=n(20),o=(n(64),n(57),{props:{deck:{type:Object,default:function(){return{}}}},data:function(){return{post:this.deck,like:this.deck.like,body:"",postComments:[],current:1,pageSize:3}},watch:{deck:function(t){this.post=t}},created:function(){var t=this;this.socket.emit("Created",{user:this.$auth.user.userName}),this.socket.on("user-comment",(function(data){data.idPost===t.post._id&&t.post.reviews.push({body:data.bd,user:{_id:data.id,userName:data.user,avatar:data.avatar}})})),this.showMore()},mounted:function(){var t=this;this.$nextTick((function(){document.addEventListener("click",(function(e){t.$refs.menu&&(e.preventDefault(),t.$refs.menu.classList.remove("active"))}))}))},methods:{handleMenu:function(){event.stopPropagation(),this.$refs.menu.classList.toggle("active")},handleLike:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$axios.$post("/decks/"+t);case 3:n.sent.success&&e.fetchLike(t),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.error(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()},fetchLike:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$axios.$get("/decks/"+t);case 3:r=n.sent,e.like=r.deck.like,n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.error(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()},handleSave:function(){var t=this;this.$axios.$post("/api/auth/user/"+this.post._id).then((function(e){e.success&&(t.$notification.success({message:t.$t("Thông báo"),description:t.$t("Thay đổi thành công")}),t.$auth.fetchUser())})).catch((function(t){console.error(t)}))},onAddReview:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.body){e.next=14;break}return e.prev=1,t.socket.emit("user-comment",{bd:t.body,user:t.$auth.user.userName,avatar:t.$auth.user.avatar,id:t.$auth.user._id,idPost:t.post._id}),(data=new FormData).append("body",t.body),e.next=7,t.$axios.$post("/reviews/".concat(t.deck._id),data);case 7:e.sent.success&&(t.body=null),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})))()},handleDelete:function(){var t=this;this.$axios.$delete("/decks/"+this.deck._id).then((function(e){e.success&&(t.$notification.success({message:t.$t("Thông báo"),description:t.$t("Xóa thành công")}),t.$emit("fetchDelete",t.deck._id))})).catch((function(t){return console.error(t)}))},showMore:function(){var t=this.pageSize*this.current;t>this.post.reviews.length?t=this.post.reviews.length:this.current+=1,this.postComments=this.post.reviews.slice(0,t)}}}),c=n(27),component=Object(c.a)(o,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"post-card"},[r("div",{staticClass:"actor"},[r("div",{staticClass:"actor__avt"},[t.post.owner.avatar?r("img",{attrs:{src:t.post.owner.avatar,alt:"Avatar"}}):r("img",{attrs:{src:n(338),alt:""}})]),t._v(" "),r("div",{staticClass:"actor__name"},[r("div",{staticClass:"actor__name-text"},[t.post.owner._id===t.$auth.user._id?r("nuxt-link",{attrs:{to:"/profile"}},[t._v(t._s(t.post.owner.userName))]):r("nuxt-link",{attrs:{to:"/profile/"+t.post.owner._id}},[t._v(t._s(t.post.owner.userName))])],1),t._v(" "),r("div",{staticClass:"actor__name-time"},[t._v(t._s(t.post.date))])]),t._v(" "),r("div",{staticClass:"actor__action"},[r("ThreeDot",{nativeOn:{click:function(e){return t.handleMenu.apply(null,arguments)}}}),t._v(" "),r("div",{ref:"menu",staticClass:"menu"},[t.deck.owner._id===t.$auth.user._id?r("div",{staticClass:"menu__item"},[r("a-icon",{attrs:{type:"edit"}}),t._v("\n          "+t._s(t.$t("Chỉnh sửa"))+"\n        ")],1):t._e(),t._v(" "),t.deck.owner._id===t.$auth.user._id?r("div",{staticClass:"menu__item",on:{click:t.handleDelete}},[r("a-icon",{attrs:{type:"delete"}}),t._v("\n          "+t._s(t.$t("Xóa bài viết"))+"\n        ")],1):t._e(),t._v(" "),r("div",{staticClass:"menu__item"},[r("a-icon",{attrs:{type:"alert"}}),t._v("\n          "+t._s(t.$t("Báo cáo vi phạm"))+"\n        ")],1)])],1)]),t._v(" "),r("div",{staticClass:"image"},[r("client-only",[r("Lightbox",{attrs:{cells:3,items:t.post.image}})],1)],1),t._v(" "),r("div",{staticClass:"content"},[r("client-only",[r("vue-show-more-text",{attrs:{text:t.post.content,lines:4,"more-text":t.$t("Xem thêm"),"less-text":t.$t("Thu gọn"),"additional-anchor-css":"color: #EA4C89","additional-container-css":"padding: initial"}})],1)],1),t._v(" "),r("div",{staticClass:"bar"},[r("div",{staticClass:"bar__item",on:{click:function(e){return t.handleLike(t.post._id)}}},[-1===t.like.indexOf(t.$auth.user._id)?r("a-icon",{staticClass:"bar__item-icon",attrs:{type:"heart"}}):r("a-icon",{staticClass:"bar__item-icon",staticStyle:{color:"#d7443e"},attrs:{type:"heart",theme:"filled"}}),t._v(" "),r("p",[t._v(t._s(t.like.length)+" "+t._s(t.$t("Yêu thích")))])],1),t._v(" "),r("nuxt-link",{staticClass:"bar__item",attrs:{to:"/post/"+t.post._id}},[r("a-icon",{staticClass:"bar__item-icon",attrs:{type:"message"}}),t._v(" "),r("p",[t._v(t._s(t.post.reviews.length)+" "+t._s(t.$t("Bình luận")))])],1),t._v(" "),r("div",{staticClass:"bar__item",on:{click:t.handleSave}},[r("a-icon",{staticClass:"bar__item-icon",attrs:{type:"save"}}),t._v(" "),-1===t.$auth.user.deckShare.map((function(t){return t._id})).indexOf(t.post._id)?r("p",[t._v(t._s(t.$t("Lưu bài viết")))]):r("p",[t._v(t._s(t.$t("Bỏ lưu")))])],1)],1),t._v(" "),t.post.reviews.length>0?r("div",{staticClass:"comments"},[t._l(t.postComments,(function(e,o){return r("div",{key:o,staticClass:"comments__item"},[r("div",{staticClass:"comments__item-avt"},[e.user.avatar?r("img",{attrs:{src:e.user.avatar,alt:"avatar"}}):r("img",{attrs:{src:n(338),alt:"avatar"}})]),t._v(" "),r("div",{staticClass:"comments__item-content"},[e.user._id===t.$auth.user._id?r("nuxt-link",{staticClass:"name",attrs:{to:"/profile"}},[t._v("\n          "+t._s(e.user.userName)+"\n        ")]):r("nuxt-link",{staticClass:"name",attrs:{to:"/profile/"+e.user._id}},[t._v(t._s(e.user.userName))]),t._v(" "),r("div",{staticClass:"body",domProps:{innerHTML:t._s(e.body)}})],1)])})),t._v(" "),t.postComments.length<t.post.reviews.length?r("p",{staticClass:"comments__btn",on:{click:t.showMore}},[t._v(t._s(t.$t("Hiển thị thêm")))]):t._e()],2):t._e(),t._v(" "),r("div",{staticClass:"comment"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.body,expression:"body"}],staticClass:"comment__input",attrs:{type:"text",placeholder:t.$t("Viết bình luận")},domProps:{value:t.body},on:{input:function(e){e.target.composing||(t.body=e.target.value)}}}),t._v(" "),r("i",{staticClass:"fas fa-paper-plane icon",on:{click:t.onAddReview}})])])}),[],!1,null,null,null);e.default=component.exports}}]);