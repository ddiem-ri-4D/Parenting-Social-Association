(window.webpackJsonp=window.webpackJsonp||[]).push([[28,9],{1002:function(e,t,r){"use strict";r.r(t);var n=r(20),c=(r(57),r(78),r(33),r(198),{components:{ListUser:r(968).default},data:function(){return{dataLoaded:!1,user:{},users:[],messages:[],newMessage:null,message:null,selectedFile:[],body:"",userId:this.$auth.user._id,friendId:this.$route.params.id,typing:!1,userTyping:""}},fetch:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.$store.getters.getUserGroup.length){t.next=3;break}return t.next=3,e.$store.dispatch("setUserGroup");case 3:return e.users=e.$store.getters.getUserGroup,e.user=e.$store.getters.getUserGroup.filter((function(t){return t._id===e.$route.params.id}))[0],t.prev=5,t.next=8,e.$axios.$get("/message/"+e.$route.params.id);case 8:(r=t.sent).success&&(e.messages=r.messages,e.dataLoaded=!0),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5),console.error(t.t0);case 15:case"end":return t.stop()}}),t,null,[[5,12]])})))()},head:function(){return{title:this.$t("Tin nhắn")+" | PSA   "}},watch:{newMessage:function(e){e?this.socket.emit("typing",{userName:this.$auth.user.userName,userId:this.userId}):this.socket.emit("stopTyping",{userName:this.$auth.user.userName,userId:this.userId})}},mounted:function(){var e=this,t=setInterval((function(){void 0!==e.$refs.messBox&&(e.$refs.messScroll.scrollTo(0,e.$refs.messBox.scrollHeight),clearInterval(t))}),500)},created:function(){var e=this;this.socket.emit("joined",{user:this.userId,friend:this.friendId}),this.socket.on("chat-message",(function(data){data.userId===e.friendId&&e.messages.push({message:data.message,to:data.to,from:data.from})})),this.socket.on("typing",(function(data){data.userId===e.friendId&&(e.typing=!0,e.userTyping=data.userName)})),this.socket.on("stopTyping",(function(data){data.userId===e.friendId&&(e.typing=!1)}))},methods:{onChat:function(){this.$refs.boxChat.style.height="auto",this.$refs.boxChat.style.height=this.$refs.boxChat.scrollHeight-14+"px"},onSend:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.socket.emit("chat-message",{message:e.newMessage,to:e.$route.params.id,from:e.$auth.user._id,userId:e.userId,userName:e.$auth.user.userName}),(data=new FormData).append("message",e.newMessage),t.next=6,e.$axios.$post("/message/".concat(e.$route.params.id),data);case 6:if(!t.sent.success){t.next=12;break}return t.next=10,e.messages.push({message:e.newMessage,to:e.$route.params.id,from:e.$auth.user._id});case 10:e.$refs.messScroll.scrollTo(0,e.$refs.messBox.scrollHeight),e.newMessage=null;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),console.error(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})))()}}}),o=r(27),component=Object(o.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("main",{staticClass:"main-wrapper message in-chat"},[n("div",{staticClass:"box-mess"},[n("list-user",{attrs:{users:e.users}}),e._v(" "),n("div",{staticClass:"message__content"},[e.user?n("div",{staticClass:"message__content-head"},[n("nuxt-link",{staticClass:"btn-back",attrs:{to:"/message"}},[n("i",{staticClass:"fal fa-chevron-left icon"})]),e._v(" "),n("div",{staticClass:"avt"},[e.user.avatar?n("img",{attrs:{src:e.user.avatar,alt:"avatar"}}):n("img",{attrs:{src:r(338),alt:""}})]),e._v(" "),n("nuxt-link",{staticClass:"name",attrs:{to:/profile/+e.user._id}},[e._v(e._s(e.user.userName))])],1):e._e(),e._v(" "),n("div",{staticClass:"message__content-main"},[n("div",{staticClass:"contain-mess"},[n("div",{ref:"messScroll",staticClass:"contain-mess-scroll"},[e.dataLoaded?n("ul",{ref:"messBox",staticClass:"mess"},e._l(e.messages,(function(t,c){return n("li",{key:c,staticClass:"mess__item",class:{to:t.from===e.$auth.user._id}},[n("div",{staticClass:"mess__item-avt"},[t.from===e.$auth.user._id&&e.$auth.user.avatar?n("img",{attrs:{src:e.$auth.user.avatar,alt:"avatar"}}):t.from===e.user._id&&e.user.avatar?n("img",{attrs:{src:e.user.avatar,alt:"avatar"}}):n("img",{attrs:{src:r(338),alt:"avatar"}})]),e._v(" "),n("p",{staticClass:"mess__item-content"},[e._v(e._s(t.message))])])})),0):e._l(4,(function(e){return n("a-skeleton",{key:e,attrs:{loading:!0,active:"",avatar:""}})}))],2)]),e._v(" "),e.typing?n("p",{staticClass:"typing"},[e._v("\n          "+e._s(e.userTyping)+" "+e._s(e.$t("đang soạn tin nhắn"))+"\n          "),n("span",{staticClass:"dot-typing"})]):e._e(),e._v(" "),n("div",{staticClass:"bar"},[n("div",{staticClass:"bar-contain"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.newMessage,expression:"newMessage"}],ref:"boxChat",attrs:{type:"text",placeholder:"Aa"},domProps:{value:e.newMessage},on:{input:[function(t){t.target.composing||(e.newMessage=t.target.value)},e.onChat]}}),e._v(" "),n("i",{staticClass:"fas fa-paper-plane icon",on:{click:e.onSend}})])])])])],1)])}),[],!1,null,null,null);t.default=component.exports},968:function(e,t,r){"use strict";r.r(t);r(46),r(339),r(198),r(78),r(33),r(93),r(94);var n={props:{users:{type:Array,default:function(){return[]}}},data:function(){return{listSearch:this.users||[],visible:!1,search:"",searching:!1}},watch:{users:function(e){this.listSearch=e}},methods:{handleOpenModal:function(){this.visible=!0},handleCancel:function(){},onInput:function(){var e=this,t=this.search;this.searching=!0,setTimeout((function(){t===e.search&&(e.searching=!1,e.listSearch=e.users.filter((function(t){return encodeURI(t.userName.toLowerCase()).includes(encodeURI(e.search))})))}),500)}}},c=r(27),component=Object(c.a)(n,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"list-user"},[n("div",{staticClass:"top"},[n("i",{staticClass:"fal fa-edit icon",on:{click:e.handleOpenModal}})]),e._v(" "),n("div",{staticClass:"users"},[e._l(e.$auth.user.userChat,(function(t,c){return n("nuxt-link",{key:c,staticClass:"users__item",attrs:{to:/message/+t._id}},[n("div",{staticClass:"users__item-avt"},[t.avatar?n("img",{attrs:{src:t.avatar,alt:"avatar"}}):n("img",{attrs:{src:r(338),alt:"avatar"}})]),e._v(" "),n("div",{staticClass:"users__item-info"},[n("p",{staticClass:"name"},[e._v(e._s(t.userName))]),e._v(" "),n("p",{staticClass:"last-mess"})])])})),e._v(" "),n("a-modal",{staticClass:"modal-new-message",attrs:{centered:"",title:e.$t("Tin nhắn mới"),footer:!1},on:{cancek:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("template",{slot:"closeIcon"},[n("i",{staticClass:"fal fa-times icon"})]),e._v(" "),n("div",{staticClass:"search"},[n("p",[e._v(e._s(e.$t("Tới"))+":")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"search-input",attrs:{type:"text",placeholder:e.$t("Tìm kiếm")},domProps:{value:e.search},on:{input:[function(t){t.target.composing||(e.search=t.target.value)},e.onInput]}})]),e._v(" "),n("div",{staticClass:"suggests"},[e.searching?n("div",e._l(5,(function(e){return n("a-skeleton",{key:e,attrs:{active:"",avatar:"",paragraph:{rows:1}}})})),1):e._l(e.listSearch,(function(t,c){return n("nuxt-link",{key:c,staticClass:"suggests__item",attrs:{to:"/message/"+t._id}},[n("div",{staticClass:"suggests__item-avt"},[t.avatar?n("img",{attrs:{src:t.avatar,alt:"avatar"}}):n("img",{attrs:{src:r(338),alt:"avatar"}})]),e._v(" "),n("p",{staticClass:"suggests__item-name"},[e._v(e._s(t.userName))])])}))],2)],2)],2)])}),[],!1,null,null,null);t.default=component.exports}}]);